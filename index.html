<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dynamic QR Linker</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; }
        .form-container { max-width: 400px; }
        .dashboard-container { max-width: 800px; }
        /* Basic styling for message popups */
        .message-popup {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            padding: 12px 20px;
            border-radius: 8px;
            color: white;
            z-index: 1000;
            opacity: 0;
            transition: opacity 0.3s ease-in-out, transform 0.3s ease-in-out;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        .message-popup.show {
            opacity: 1;
            transform: translateX(-50%) translateY(0);
        }
        .message-popup.success { background-color: #28a745; } /* Green */
        .message-popup.error { background-color: #dc3545; } /* Red */
    </style>
</head>
<body class="bg-gray-100 text-gray-800 min-h-screen flex flex-col items-center justify-center p-4">

    <script type="module">
        // Import the functions you need from the SDKs you need
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.8.1/firebase-app.js";
        import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/11.8.1/firebase-auth.js";
        import { getFirestore, collection, addDoc, query, where, getDocs, serverTimestamp, doc, deleteDoc, updateDoc } from "https://www.gstatic.com/firebasejs/11.8.1/firebase-firestore.js";

        // Your web app's Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyC7zHDiTQqReFpPzph7M49o3560UGIl3u0", // Replace with your actual API key if different
            authDomain: "dynamic-qr-bb507.firebaseapp.com",
            projectId: "dynamic-qr-bb507",
            storageBucket: "dynamic-qr-bb507.firebasestorage.app", // Corrected from .firebasestorage.app
            messagingSenderId: "479705625954",
            appId: "1:479705625954:web:9bfd7b5c753dd643e2283b",
            measurementId: "G-LJGGHDVYLB" // Optional
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);

        // --- DOM Elements ---
        const authContainer = document.getElementById('authContainer');
        const loginForm = document.getElementById('loginForm');
        const signupForm = document.getElementById('signupForm');
        const switchToSignup = document.getElementById('switchToSignup');
        const switchToLogin = document.getElementById('switchToLogin');

        const dashboardContainer = document.getElementById('dashboardContainer');
        const userEmailDisplay = document.getElementById('userEmailDisplay');
        const logoutButton = document.getElementById('logoutButton');
        
        const messagePopup = document.createElement('div');
        messagePopup.className = 'message-popup';
        document.body.appendChild(messagePopup);

        // --- Utility Functions ---
        function showMessage(message, type = 'success', duration = 3000) {
            messagePopup.textContent = message;
            messagePopup.className = `message-popup ${type} show`; // Add 'show' class
            setTimeout(() => {
                messagePopup.classList.remove('show');
            }, duration);
        }
        
        // --- Auth State Observer ---
        onAuthStateChanged(auth, (user) => {
            if (user) {
                // User is signed in
                console.log("User signed in:", user.email);
                authContainer.classList.add('hidden');
                dashboardContainer.classList.remove('hidden');
                userEmailDisplay.textContent = user.email;
                // (We will load user's links here in a later step)
            } else {
                // User is signed out
                console.log("User signed out");
                authContainer.classList.remove('hidden');
                dashboardContainer.classList.add('hidden');
                userEmailDisplay.textContent = '';
                // Clear any sensitive dashboard data if necessary
            }
        });

        // --- Event Listeners (will be implemented in Step 2) ---
        // Login Form
        loginForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            // Login logic will go here in Step 2
            showMessage('Login functionality to be implemented.', 'error');
        });

        // Signup Form
        signupForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            // Signup logic will go here in Step 2
            showMessage('Signup functionality to be implemented.', 'error');
        });
        
        // Logout Button
        logoutButton.addEventListener('click', async () => {
            // Logout logic will go here in Step 2
            showMessage('Logout functionality to be implemented.', 'error');
        });

        // Switch between Login and Signup forms
        switchToSignup.addEventListener('click', (e) => {
            e.preventDefault();
            loginForm.classList.add('hidden');
            signupForm.classList.remove('hidden');
        });

        switchToLogin.addEventListener('click', (e) => {
            e.preventDefault();
            signupForm.classList.add('hidden');
            loginForm.classList.remove('hidden');
        });

        // Make functions globally accessible for now if needed, or keep them module-scoped
        window.auth = auth; // For debugging or direct calls if necessary
        window.db = db;     // For debugging or direct calls if necessary
    </script>

    <div id="authContainer" class="w-full">
        <form id="loginForm" class="form-container mx-auto bg-white p-8 rounded-lg shadow-xl">
            <h2 class="text-2xl font-bold mb-6 text-center text-indigo-600">Login</h2>
            <div class="mb-4">
                <label for="loginEmail" class="block text-sm font-medium text-gray-700 mb-1">Email</label>
                <input type="email" id="loginEmail" name="email" required class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500">
            </div>
            <div class="mb-6">
                <label for="loginPassword" class="block text-sm font-medium text-gray-700 mb-1">Password</label>
                <input type="password" id="loginPassword" name="password" required class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500">
            </div>
            <button type="submit" class="w-full bg-indigo-600 text-white py-2 px-4 rounded-md hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 transition duration-150">Login</button>
            <p class="mt-6 text-center text-sm">
                Don't have an account? <a href="#" id="switchToSignup" class="font-medium text-indigo-600 hover:text-indigo-500">Sign up</a>
            </p>
        </form>

        <form id="signupForm" class="form-container mx-auto bg-white p-8 rounded-lg shadow-xl hidden">
            <h2 class="text-2xl font-bold mb-6 text-center text-teal-600">Sign Up</h2>
            <div class="mb-4">
                <label for="signupEmail" class="block text-sm font-medium text-gray-700 mb-1">Email</label>
                <input type="email" id="signupEmail" name="email" required class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-teal-500 focus:border-teal-500">
            </div>
            <div class="mb-6">
                <label for="signupPassword" class="block text-sm font-medium text-gray-700 mb-1">Password (min. 6 characters)</label>
                <input type="password" id="signupPassword" name="password" required class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-teal-500 focus:border-teal-500">
            </div>
            <button type="submit" class="w-full bg-teal-600 text-white py-2 px-4 rounded-md hover:bg-teal-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-teal-500 transition duration-150">Sign Up</button>
            <p class="mt-6 text-center text-sm">
                Already have an account? <a href="#" id="switchToLogin" class="font-medium text-teal-600 hover:text-teal-500">Login</a>
            </p>
        </form>
    </div>

    <div id="dashboardContainer" class="dashboard-container mx-auto bg-white p-8 rounded-lg shadow-xl hidden w-full">
        <div class="flex justify-between items-center mb-6">
            <div>
                <h1 class="text-3xl font-bold text-indigo-700">My Dynamic Links</h1>
                <p class="text-gray-600">Welcome, <span id="userEmailDisplay" class="font-semibold">user@example.com</span>!</p>
            </div>
            <button id="logoutButton" class="bg-red-500 text-white py-2 px-4 rounded-md hover:bg-red-600 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-400 transition duration-150">Logout</button>
        </div>

        <div id="createLinkContainer" class="mb-8 p-6 bg-gray-50 rounded-lg shadow">
            <h2 class="text-xl font-semibold mb-4 text-gray-700">Create New Dynamic Link</h2>
            <form id="createLinkForm">
                <div class="mb-4">
                    <label for="destinationUrl" class="block text-sm font-medium text-gray-700 mb-1">Destination URL (e.g., https://example.com)</label>
                    <input type="url" id="destinationUrl" name="destinationUrl" required placeholder="https://your-target-link.com" class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500">
                </div>
                <div class="mb-4">
                    <label for="linkName" class="block text-sm font-medium text-gray-700 mb-1">Link Name (Optional)</label>
                    <input type="text" id="linkName" name="linkName" placeholder="My Awesome Campaign" class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500">
                </div>
                <button type="submit" class="bg-green-500 text-white py-2 px-4 rounded-md hover:bg-green-600 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-400 transition duration-150">
                    Create Link & Get QR
                </button>
            </form>
        </div>

        <div id="linksListContainer">
            <h2 class="text-xl font-semibold mb-4 text-gray-700">Your Links</h2>
            <div id="linksList" class="space-y-4">
                <!-- 
                <div class="bg-white p-4 rounded-lg shadow border border-gray-200">
                    <div class="flex justify-between items-start">
                        <div>
                            <h3 class="font-semibold text-lg text-indigo-600">Link Name / Short URL</h3>
                            <p class="text-sm text-gray-500 truncate">Original URL: https://very-long-original-url.com/with/lots/of/parameters</p>
                            <p class="text-sm text-blue-500">Short Link: yourdomain.com/r/?id=xxxxxx</p>
                        </div>
                        <div class="flex-shrink-0 ml-4">
                            QR Code Image
                        </div>
                    </div>
                    <div class="mt-2 flex space-x-2">
                        <button class="text-sm text-blue-500 hover:underline">Edit</button>
                        <button class="text-sm text-red-500 hover:underline">Delete</button>
                    </div>
                </div> 
                -->
                <p class="text-gray-500">You haven't created any links yet. Use the form above to get started!</p>
            </div>
        </div>
    </div>

</body>
</html>
